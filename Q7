CREATE TABLE o_rollcall (
    roll_no INT,
    name VARCHAR(20),
    address VARCHAR(20)
);

CREATE TABLE n_rollcall (
    roll_no INT,
    name VARCHAR(20),
    address VARCHAR(20)
);

INSERT INTO o_rollcall VALUES ('1', 'Hitesh', 'Nandura');
INSERT INTO o_rollcall VALUES ('2', 'Piyush', 'MP');
INSERT INTO o_rollcall VALUES ('3', 'Ashley', 'Nsk');
INSERT INTO o_rollcall VALUES ('4', 'Kalpesh', 'Dhule');
INSERT INTO o_rollcall VALUES ('5', 'Abhi', 'Satara');

DELIMITER //

CREATE PROCEDURE p3(IN r1 INT)
BEGIN
    DECLARE r2 INT;
    DECLARE exit_loop BOOLEAN DEFAULT FALSE;

    -- Cursor declaration (parameterized: depends on r1)
    DECLARE c1 CURSOR FOR
        SELECT roll_no FROM o_rollcall WHERE roll_no > r1;

    -- Handler to stop loop when cursor finishes
    DECLARE CONTINUE HANDLER FOR NOT FOUND SET exit_loop = TRUE;

    -- Open cursor
    OPEN c1;

    -- Loop through results
    e_loop: LOOP
        FETCH c1 INTO r2;

        -- Insert if not already in n_rollcall
        IF NOT EXISTS (SELECT * FROM n_rollcall WHERE roll_no = r2) THEN
            INSERT INTO n_rollcall
            SELECT * FROM o_rollcall WHERE roll_no = r2;
        END IF;

        -- Exit when no more rows
        IF exit_loop THEN
            CLOSE c1;
            LEAVE e_loop;
        END IF;
    END LOOP e_loop;

END //
DELIMITER ;

-- Copy all records where roll_no > 3
CALL p3(3);

-- Copy all records (roll_no > 0)
CALL p3(0);

-- Add a new record in old table
INSERT INTO o_rollcall VALUES ('6', 'Patil', 'Kolhapur');

-- Copy new records where roll_no > 4
CALL p3(4);

SELECT * FROM o_rollcall;

SELECT * FROM n_rollcall;
